<h1>Elementary Teachers</h1>

       
<div class="header-bar">
    <div class="form-group">
        <select class="form-select shadow-none select-opt" [(ngModel)]="selectedGradeLevel" (change)="manageTeachers(selectedGradeLevel?.dept_id, selectedGradeLevel?.gradelvl_id)">
        <option [value]="null" disabled>Select Grade</option>
        <option *ngFor="let level of gradelvl" [ngValue]="level">{{ level.name }}</option>
        </select>
    </div>
    

    <div class="input-group form-outline form-group">
        <input type="search" id="form1" class="form-control search-bar" placeholder="Search" aria-label="Search"/>
        <span class="input-group-text">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
            <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
        </svg>
        </span>
    </div>

    <button type="button" class="btn btn-custom d-flex align-items-center shadow-none form-group" data-bs-toggle="modal" data-bs-target="#addSection">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-circle" viewBox="0 0 16 16">
            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
            <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
          </svg>
        <span class="ms-2 align-middle">Add Teacher</span>
    </button>

    

</div>

<div class="modal fade" id="addSection" tabindex="-1" role="dialog" aria-labelledby="addSectionModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addSectionModalLabel">Add Teacher</h5>
          <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <app-add-teacher></app-add-teacher>
        </div>
        
      </div>
    </div>
  </div>

  
<table class="table table-striped">
    <thead>
    <tr>
        <th scope="col">#</th>
        <!-- <th scope="col">Grade Level</th> -->
        <th scope="col">First Name</th>
        <th scope="col">Middle Name</th>
        <th scope="col">Last Name</th>
        <th scope="col">Address</th>

        <th scope="col">Action</th>
    </tr>
    </thead>
    <tbody *ngIf="filteredTeacher.length > 0">
        <tr *ngFor="let teacher of filteredTeacher; let i = index">
            <th scope="row">{{ i + 1 }}</th>
            <!-- <td>{{ selectedGradeLevel?.name }}</td> -->
            <td>{{ teacher.fname }}</td>
            <td>{{ teacher.mname }}</td>
            <td>{{ teacher.lname }}</td>
            <td>{{ teacher.address }}</td>


            <td>
                <button (click)="editTeacher(teacher)" class="btn btn-custom-edit align-items-center shadow-none" data-bs-toggle="modal" data-bs-target="#editSection">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-pencil-square edit-icon" viewBox="0 0 16 16">
                        <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
                        <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/>
                    </svg>
                </button>
                <button (click)="deleteTeacher(teacher.id)" class="btn btn-custom-delete align-items-center shadow-none">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-trash3 trash-icon" viewBox="0 0 16 16">
                        <path d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5ZM11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H2.506a.58.58 0 0 0-.01 0H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1h-.995a.59.59 0 0 0-.01 0H11Zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5h9.916Zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47ZM8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5Z"/>
                    </svg>
                </button>
                <button (click)="assignTeacher(teacher.id)" class="btn btn-warning btn-custom-assign align-items-center shadow-none" data-bs-toggle="modal" data-bs-target="#assignTeacher">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-journal-plus" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M8 5.5a.5.5 0 0 1 .5.5v1.5H10a.5.5 0 0 1 0 1H8.5V10a.5.5 0 0 1-1 0V8.5H6a.5.5 0 0 1 0-1h1.5V6a.5.5 0 0 1 .5-.5z"/>
                        <path d="M3 0h10a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2v-1h1v1a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v1H1V2a2 2 0 0 1 2-2z"/>
                        <path d="M1 5v-.5a.5.5 0 0 1 1 0V5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1zm0 3v-.5a.5.5 0 0 1 1 0V8h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1zm0 3v-.5a.5.5 0 0 1 1 0v.5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1z"/>
                      </svg>
                </button>

                <button type="button" class="btn btn-info btn-custom-list" data-bs-toggle="modal" data-bs-target="#exampleModal" (click)="fetchAssignedDataForTeacher(teacher.id)">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-list-columns-reverse" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M0 .5A.5.5 0 0 1 .5 0h2a.5.5 0 0 1 0 1h-2A.5.5 0 0 1 0 .5Zm4 0a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1h-10A.5.5 0 0 1 4 .5Zm-4 2A.5.5 0 0 1 .5 2h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5Zm4 0a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5Zm-4 2A.5.5 0 0 1 .5 4h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5Zm4 0a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5Zm-4 2A.5.5 0 0 1 .5 6h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5Zm4 0a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 0 1h-8a.5.5 0 0 1-.5-.5Zm-4 2A.5.5 0 0 1 .5 8h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5Zm4 0a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 0 1h-8a.5.5 0 0 1-.5-.5Zm-4 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5Zm4 0a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1h-10a.5.5 0 0 1-.5-.5Zm-4 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5Zm4 0a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5Zm-4 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5Zm4 0a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5Z"/>
                      </svg>                  
                </button>            

            </td>
        </tr>

    </tbody>
    <tbody *ngIf="selectedGradeLevel && filteredTeacher.length === 0">
        <tr>
            <td colspan="7">No data found.</td>
        </tr>
    </tbody>
    <tbody *ngIf="!selectedGradeLevel && gradelvl.length > 0">
        <tr>
            <td colspan="7">Select grade level</td>
        </tr>
    </tbody>

</table>

<!-- VIEW LIST OF ASSIGNED SUBJECTS -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">List of Assigned Subjects</h5>
          <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <ng-container *ngIf="assignedSubjects.length > 0; else noDataFound">

                <div class="mb-5" *ngFor="let assignment  of assignedSubjects;let index = index ">

                    <h5><strong>Section: </strong>{{assignment.gradeLevelName}} - {{assignment.sectionName}}</h5>
                    <h5><strong>Subject: </strong>{{assignment.subjectName}}</h5>
                    <button type="button" class="btn btn-custom d-flex align-items-center shadow-none form-group" (click)="onDeleteItem(index)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash3-fill" viewBox="0 0 16 16">
                            <path d="M11 1.5v1h3.5a.5.5 0 0 1 0 1h-.538l-.853 10.66A2 2 0 0 1 11.115 16h-6.23a2 2 0 0 1-1.994-1.84L2.038 3.5H1.5a.5.5 0 0 1 0-1H5v-1A1.5 1.5 0 0 1 6.5 0h3A1.5 1.5 0 0 1 11 1.5Zm-5 0v1h4v-1a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5ZM4.5 5.029l.5 8.5a.5.5 0 1 0 .998-.06l-.5-8.5a.5.5 0 1 0-.998.06Zm6.53-.528a.5.5 0 0 0-.528.47l-.5 8.5a.5.5 0 0 0 .998.058l.5-8.5a.5.5 0 0 0-.47-.528ZM8 4.5a.5.5 0 0 0-.5.5v8.5a.5.5 0 0 0 1 0V5a.5.5 0 0 0-.5-.5Z"/>
                        </svg> 
                        <span class="ms-2 align-middle">Remove</span>
                    </button>

                </div>
            </ng-container>
            <ng-template #noDataFound>
                <p>No data found</p>
            </ng-template>

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
</div>

<!-- EDIT TEACHER MODAL -->

<div class="modal fade" id="editSection" tabindex="-1" role="dialog" aria-labelledby="editSectionModalLabel" aria-hidden="true">
<div class="modal-dialog" role="document">
    <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title" id="editSectionModalLabel">Edit Teacher</h5>
            <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            <div class="position-fixed top-0 end-0 p-3">
                <div *ngIf="showAlert" class="alert alert-success alert-dismissible fade show" role="alert">
                    <strong>Success!</strong> Section updated successfully.
                    <button type="button" class="btn-close" (click)="hideAlert()" aria-label="Close"></button>
                </div>
              
                <div class="alert alert-danger" role="alert" *ngIf="errorMessage">
                  {{ errorMessage }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            </div>

            <form [formGroup]="form">
                <h3>PERSONAL INFORMATION</h3>
                <div class="fmname">
                    <div class="input-container">
                    <input class="form-control" type="text" name="fname" placeholder="First Name" formControlName="teacherName">
                    
                    </div>
                    <div class="input-container">
                    <input class="form-control"  type="text" placeholder="Middle Name" name="mname" formControlName="teacherMname">
                    </div>
                </div>
               
                
                <div class="lname">
                    <input class="form-control"  type="text" name="lname" placeholder="Last Name" formControlName="teacherLname">
                </div>
                
                <div class="address">
                    <input class="form-control" type="text" name="address" placeholder="Address" formControlName="address">
                    
                </div>

                <div class="address">
                    <input class="form-control" type="tel" name="phone" placeholder="Phone Number" formControlName="phone" inputmode="numeric" >
                </div>

                <div class="fmname">
                    <div class="input-container">
                        <select label-placement="floating" fill="outline" label="Gender" class="form-control" name="gender" formControlName="gender" [(ngModel)]="selectedTeacher.gender">
                            <option [ngValue]="null" disabled>Select Gender</option>
                            <option [ngValue]="'Female'">Female</option>
                            <option [ngValue]="'Male'">Male</option>
                        </select>
                        
                    </div>

                    <div class="input-container">
                        <div class="input-with-icon">
                            <input placeholder="Birthdate" class="form-control" type="date" name="birthdate" formControlName="birthdate">
                        </div>
                    </div>
                </div>

                <div class="assigninfo">
                    <label class="personalinfo">ADVISING SECTION</label>
                </div>

                <div class="mb-2">
                    <div class="mb-2">
                        <select class="form-control" id="department" name="department" formControlName="department" [(ngModel)]="selectedTeacher.department" (change)="onDepartmentChange()">
                            <option value="" disabled>Select Department</option>
                            <option *ngFor="let department of departments" [value]="department.id">{{ department.name }}</option>
                        </select>
                </div>
            </div>
                <div class="fmname">
                    <div class="input-container">
                        <select class="form-control" id="gradeLevel" name="gradeLevel" formControlName="grlevel" [(ngModel)]="selectedTeacher.gradelvl_id" (change)="onGradeLevelChange()">
                            <option value="" disabled>Select Grade Level</option>
                            <option *ngFor="let gradeLevel of gradeLevels" [value]="gradeLevel.gradelvl_id">{{ gradeLevel.name }}</option>
                          </select>
                      </div>
                    <div class="input-container-section">
                        <select class="form-control" id="section" name="section" formControlName="section" [(ngModel)]="selectedTeacher.section_id" (ngModelChange)="clearSectionError()">
                            <option value="" disabled>Select Section</option>
                            <option *ngFor="let section of sections" [value]="section?.section_id">{{ section?.name }}</option>
                          </select>
                    </div>
                </div>
                <div class="error_message" *ngIf="sectionAssignmentError">{{ sectionAssignmentError }}</div>

                <div class="accdeets">
                    <label>ACCOUNT DETAILS</label>
                </div>
                
                <div class="email">
                    <input class="form-control" type="email" name="email" placeholder="Email" formControlName="email" readonly>

                </div>

            </form>             
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" (click)="saveEditedSubject()">Save Changes</button>
        </div>
    </div>
</div>
</div>

<!-- ASSIGN TEACHER -->
<div class="modal fade" id="assignTeacher" tabindex="-1" role="dialog" aria-labelledby="assignTeacherModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="assignTeacherModalLabel">Assign Subjects</h5>
                <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div *ngIf="successMessage" class="alert alert-success alert-dismissible fade show" role="alert">
                    <strong>Success!</strong> Assigned successfully.
                    <button type="button" class="btn-close" (click)="hideAlert()" aria-label="Close"></button>
                  </div>
                   
                  <div class="alert alert-danger alert-dismissible fade show" role="alert" *ngIf="errorMessage">
                    Subject is already assigned  
                  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                  </div>
                
                
                
                   <form [formGroup]="form">
                    <div class="teacher-fullname mb-4">
                      <h2>{{ selectedAssTeacher.lastName }}, {{ selectedAssTeacher.firstName }}</h2>
                    </div>
                
                  
                      <div formArrayName="assignments">
                          <div *ngFor="let assignment of assignments.controls; let i = index" [formGroupName]="i">
                              <div class="assigninfo">
                                  <label class="personalinfo"> ASSIGN SUBJECT</label>
                              </div>
                              <select class="form-control" id="assdepartment" name="department" formControlName="department" (click)="onAssDepartmentChange(i)">
                                <option value="" selected disabled>Department</option>
                                <option *ngFor="let department of departments" [value]="department?.id">{{ department?.name }}</option>
                              </select>
                              
                            <div class="container-ass">
                              <div class="input-container">
                                <select class="form-control" id="assgradeLevel" name="gradeLevel" formControlName="grlevel" (click)="onAssGradeLevelChange(i)">
                                  <option value="" disabled>Grade Level</option>
                                  <option *ngFor="let gradeLevel of assignmentData[i].gradeLevels" [value]="gradeLevel.gradelvl_id">{{ gradeLevel.name }}</option>
                                </select>
                                
                              </div>
                              <div class="input-container">
                                  <select class="form-control" id="asssection" name="section" formControlName="section" (change)="onSectionChange($event, i)">
                                      <option value="" disabled>Section</option>
                                      <option *ngFor="let section of assignmentData[i].sections" [value]="section?.section_id">{{ section?.name }}</option>
                                    </select>
                              </div>
                              <div class="input-container-subject">
                                <select class="form-control" id="subject" name="subject" formControlName="subject" (change)="onSubjectChange($event, i)">
                                    <option value="" disabled>Subject</option>
                                    <option *ngFor="let subject of assignmentData[i].subject" [value]="subject?.subject_id">{{ subject?.subject_name }}</option>
                                  </select>
                            </div>
                                
                            </div>
                            <div class="d-flex mb-4">
                                <div class="addsubjdiv mr-2" width="16" height="16">
                                    <button class="btn addsubj" (click)="addSubject()"><i class="bi bi-plus-circle-fill"></i> Add another subject</button>
                                </div>
                                <button class="btn btn-danger custom-btn" (click)="removeAssignment(i)">
                                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash3-fill" viewBox="0 0 16 16">
                                      <path d="M11 1.5v1h3.5a.5.5 0 0 1 0 1h-.538l-.853 10.66A2 2 0 0 1 11.115 16h-6.23a2 2 0 0 1-1.994-1.84L2.038 3.5H1.5a.5.5 0 0 1 0-1H5v-1A1.5 1.5 0 0 1 6.5 0h3A1.5 1.5 0 0 1 11 1.5Zm-5 0v1h4v-1a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5ZM4.5 5.029l.5 8.5a.5.5 0 1 0 .998-.06l-.5-8.5a.5.5 0 1 0-.998.06Zm6.53-.528a.5.5 0 0 0-.528.47l-.5 8.5a.5.5 0 0 0 .998.058l.5-8.5a.5.5 0 0 0-.47-.528ZM8 4.5a.5.5 0 0 0-.5.5v8.5a.5.5 0 0 0 1 0V5a.5.5 0 0 0-.5-.5Z"/>
                                    </svg>                              
                                </button>
                                

                            </div>
                            
                          </div>
                        </div>
                        
                
                  </form> 
                  
                
                <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" (click)="assignSubject()" [disabled]="!form.valid">Assign Subject</button>
                </div>
            </div>
        </div>
</div>




